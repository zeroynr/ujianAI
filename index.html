<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Deteksi Kesopanan Chat</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="container">
      <header>
        <h1>ü§ñ AI Deteksi Kesopanan Chat</h1>
        <p>Sistem AI yang belajar mendeteksi kesopanan dari feedback Anda</p>
      </header>

      <div class="main-content">
        <div class="input-section">
          <h2>üìù Masukkan Kalimat Chat</h2>
          <textarea
            id="chatInput"
            placeholder="Ketik kalimat yang ingin dianalisis..."
          ></textarea>
          <button id="analyzeBtn">Analisis Kesopanan</button>
        </div>

        <div class="result-section" id="resultSection" style="display: none">
          <h3>üîç Hasil Analisis</h3>
          <div class="prediction" id="predictionResult"></div>
          <div class="confidence" id="confidenceScore"></div>

          <div class="feedback-section">
            <h4>‚úã Apakah prediksi ini benar?</h4>
            <div class="feedback-buttons">
              <button id="correctBtn" class="feedback-btn correct">
                ‚úÖ Benar
              </button>
              <button id="wrongBtn" class="feedback-btn wrong">‚ùå Salah</button>
            </div>
          </div>

          <div
            class="correction-section"
            id="correctionSection"
            style="display: none"
          >
            <h4>üîß Koreksi yang Benar:</h4>
            <div class="correction-buttons">
              <button id="correctSopan" class="correction-btn">Sopan</button>
              <button id="correctTidakSopan" class="correction-btn">
                Tidak Sopan
              </button>
            </div>
          </div>
        </div>

        <div class="stats-section">
          <h3>üìä Statistik Model</h3>
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-number" id="totalData">0</div>
              <div class="stat-label">Total Data</div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="accuracy">0%</div>
              <div class="stat-label">Akurasi</div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="sopanCount">0</div>
              <div class="stat-label">Data Sopan</div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="tidakSopanCount">0</div>
              <div class="stat-label">Data Tidak Sopan</div>
            </div>
          </div>
        </div>

        <div class="training-data-section">
          <h3>üéì Data Training</h3>
          <div class="data-controls">
            <button id="showDataBtn">Tampilkan Data</button>
            <button id="clearDataBtn">Reset Model</button>
            <button id="exportDataBtn">Export Data</button>
          </div>
          <div id="trainingDataList" style="display: none"></div>
        </div>
      </div>
    </div>

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 900px;
        margin: 0 auto;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      header {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        color: white;
        padding: 40px;
        text-align: center;
      }

      header h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      header p {
        font-size: 1.1em;
        opacity: 0.9;
      }

      .main-content {
        padding: 40px;
      }

      .input-section {
        margin-bottom: 30px;
      }

      .input-section h2 {
        color: #333;
        margin-bottom: 20px;
        font-size: 1.5em;
      }

      #chatInput {
        width: 100%;
        min-height: 120px;
        padding: 15px;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        font-size: 16px;
        resize: vertical;
        margin-bottom: 15px;
        transition: border-color 0.3s ease;
      }

      #chatInput:focus {
        outline: none;
        border-color: #4facfe;
        box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
      }

      #analyzeBtn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 12px 30px;
        border-radius: 25px;
        font-size: 16px;
        cursor: pointer;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      #analyzeBtn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
      }

      .result-section {
        background: #f8f9fa;
        padding: 25px;
        border-radius: 15px;
        margin-bottom: 30px;
        border-left: 5px solid #4facfe;
      }

      .prediction {
        font-size: 1.5em;
        font-weight: bold;
        margin-bottom: 10px;
        padding: 15px;
        border-radius: 10px;
        text-align: center;
      }

      .prediction.sopan {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        color: white;
      }

      .prediction.tidak-sopan {
        background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        color: white;
      }

      .confidence {
        text-align: center;
        font-size: 1.1em;
        color: #666;
        margin-bottom: 20px;
      }

      .feedback-section {
        text-align: center;
        margin-bottom: 20px;
      }

      .feedback-section h4 {
        margin-bottom: 15px;
        color: #333;
      }

      .feedback-buttons {
        display: flex;
        gap: 15px;
        justify-content: center;
      }

      .feedback-btn {
        padding: 10px 25px;
        border: none;
        border-radius: 20px;
        font-size: 16px;
        cursor: pointer;
        transition: transform 0.2s ease;
      }

      .feedback-btn.correct {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        color: white;
      }

      .feedback-btn.wrong {
        background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        color: white;
      }

      .feedback-btn:hover {
        transform: translateY(-2px);
      }

      .correction-section {
        text-align: center;
        padding: 20px;
        background: #fff;
        border-radius: 10px;
        border: 2px dashed #ddd;
      }

      .correction-buttons {
        display: flex;
        gap: 15px;
        justify-content: center;
        margin-top: 15px;
      }

      .correction-btn {
        padding: 10px 20px;
        border: 2px solid #667eea;
        background: white;
        color: #667eea;
        border-radius: 20px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .correction-btn:hover {
        background: #667eea;
        color: white;
      }

      .stats-section {
        margin-bottom: 30px;
      }

      .stats-section h3 {
        color: #333;
        margin-bottom: 20px;
        font-size: 1.5em;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
      }

      .stat-card {
        background: white;
        padding: 25px;
        border-radius: 15px;
        text-align: center;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
      }

      .stat-card:hover {
        transform: translateY(-5px);
      }

      .stat-number {
        font-size: 2.5em;
        font-weight: bold;
        color: #667eea;
        margin-bottom: 5px;
      }

      .stat-label {
        color: #666;
        font-size: 1.1em;
      }

      .training-data-section h3 {
        color: #333;
        margin-bottom: 20px;
        font-size: 1.5em;
      }

      .data-controls {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }

      .data-controls button {
        padding: 8px 16px;
        border: 1px solid #667eea;
        background: white;
        color: #667eea;
        border-radius: 15px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .data-controls button:hover {
        background: #667eea;
        color: white;
      }

      #trainingDataList {
        max-height: 400px;
        overflow-y: auto;
        background: #f8f9fa;
        border-radius: 10px;
        padding: 20px;
      }

      .data-item {
        background: white;
        padding: 15px;
        margin-bottom: 10px;
        border-radius: 8px;
        border-left: 4px solid #4facfe;
      }

      .data-item.tidak-sopan {
        border-left-color: #fa709a;
      }

      .data-text {
        font-weight: bold;
        margin-bottom: 5px;
      }

      .data-label {
        color: #666;
        font-size: 0.9em;
      }

      @media (max-width: 768px) {
        .container {
          margin: 10px;
          border-radius: 15px;
        }

        header {
          padding: 30px 20px;
        }

        header h1 {
          font-size: 2em;
        }

        .main-content {
          padding: 20px;
        }

        .feedback-buttons {
          flex-direction: column;
          align-items: center;
        }

        .correction-buttons {
          flex-direction: column;
          align-items: center;
        }

        .stats-grid {
          grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        }

        .data-controls {
          justify-content: center;
        }
      }
    </style>

    <script>
      class PolitenessDetector {
        constructor() {
          this.trainingData = this.loadTrainingData();
          this.model = this.initializeModel();
          this.currentPrediction = null;
          this.currentText = "";
          this.correctPredictions = 0;
          this.totalPredictions = 0;

          this.initializeUI();
          this.updateStats();
        }

        initializeModel() {
          // Simple Naive Bayes-like model
          return {
            sopanWords: new Set([
              "terima kasih",
              "tolong",
              "maaf",
              "permisi",
              "selamat",
              "mohon",
              "silakan",
              "dengan hormat",
              "baik",
              "bagus",
              "hebat",
              "keren",
              "mantap",
            ]),
            tidakSopanWords: new Set([
              "bodoh",
              "goblok",
              "tolol",
              "bangsat",
              "anjing",
              "bego",
              "idiot",
              "sialan",
              "kampret",
              "mampus",
              "tai",
              "sial",
            ]),
            sopanPatterns: [
              /\b(terima kasih|makasih|thanks)\b/i,
              /\b(tolong|mohon|please)\b/i,
              /\b(maaf|sorry|permisi)\b/i,
              /\b(selamat|bagus|hebat|keren)\b/i,
            ],
            tidakSopanPatterns: [
              /\b(bodoh|goblok|tolol|bego|idiot)\b/i,
              /\b(bangsat|anjing|kampret|sialan)\b/i,
              /\b(mampus|tai|sial)\b/i,
              /[!]{3,}|[?]{3,}/g,
            ],
          };
        }

        loadTrainingData() {
          const saved = JSON.parse(
            sessionStorage.getItem("politenessTrainingData") || "[]"
          );
          return saved.length > 0
            ? saved
            : [
                { text: "terima kasih banyak atas bantuannya", label: "sopan" },
                { text: "tolong bantu saya", label: "sopan" },
                { text: "maaf mengganggu waktu anda", label: "sopan" },
                {
                  text: "selamat pagi, semoga hari anda menyenangkan",
                  label: "sopan",
                },
                { text: "kamu bodoh sekali", label: "tidak sopan" },
                { text: "dasar goblok", label: "tidak sopan" },
                { text: "pergi sana tolol", label: "tidak sopan" },
                { text: "bangsat lu", label: "tidak sopan" },
              ];
        }

        saveTrainingData() {
          sessionStorage.setItem(
            "politenessTrainingData",
            JSON.stringify(this.trainingData)
          );
        }

        extractFeatures(text) {
          const features = {
            sopanWordCount: 0,
            tidakSopanWordCount: 0,
            sopanPatternCount: 0,
            tidakSopanPatternCount: 0,
            hasGreeting: false,
            hasThanks: false,
            hasApology: false,
            hasExcessivePunctuation: false,
            length: text.length,
            wordCount: text.split(" ").length,
          };

          const lowerText = text.toLowerCase();

          // Count sopan words
          this.model.sopanWords.forEach((word) => {
            if (lowerText.includes(word)) {
              features.sopanWordCount++;
            }
          });

          // Count tidak sopan words
          this.model.tidakSopanWords.forEach((word) => {
            if (lowerText.includes(word)) {
              features.tidakSopanWordCount++;
            }
          });

          // Check patterns
          this.model.sopanPatterns.forEach((pattern) => {
            if (pattern.test(text)) {
              features.sopanPatternCount++;
            }
          });

          this.model.tidakSopanPatterns.forEach((pattern) => {
            if (pattern.test(text)) {
              features.tidakSopanPatternCount++;
            }
          });

          // Specific features
          features.hasGreeting =
            /\b(halo|hai|selamat|pagi|siang|sore|malam)\b/i.test(text);
          features.hasThanks = /\b(terima kasih|makasih|thanks)\b/i.test(text);
          features.hasApology = /\b(maaf|sorry)\b/i.test(text);
          features.hasExcessivePunctuation = /[!]{2,}|[?]{2,}/.test(text);

          return features;
        }

        trainFromData() {
          // Update model vocabulary from training data
          this.trainingData.forEach((item) => {
            const words = item.text.toLowerCase().split(/\s+/);
            words.forEach((word) => {
              if (item.label === "sopan" && word.length > 2) {
                this.model.sopanWords.add(word);
              } else if (item.label === "tidak sopan" && word.length > 2) {
                this.model.tidakSopanWords.add(word);
              }
            });
          });
        }

        predict(text) {
          if (!text.trim()) return { prediction: "sopan", confidence: 0.5 };

          this.trainFromData();
          const features = this.extractFeatures(text);

          let sopanScore = 0;
          let tidakSopanScore = 0;

          // Scoring based on features
          sopanScore += features.sopanWordCount * 2;
          sopanScore += features.sopanPatternCount * 1.5;
          sopanScore += features.hasGreeting ? 1 : 0;
          sopanScore += features.hasThanks ? 2 : 0;
          sopanScore += features.hasApology ? 1.5 : 0;

          tidakSopanScore += features.tidakSopanWordCount * 3;
          tidakSopanScore += features.tidakSopanPatternCount * 2;
          tidakSopanScore += features.hasExcessivePunctuation ? 1 : 0;

          // Default bias toward sopan for neutral text
          if (sopanScore === 0 && tidakSopanScore === 0) {
            sopanScore = 1;
          }

          const totalScore = sopanScore + tidakSopanScore;
          const confidence =
            totalScore > 0
              ? Math.max(sopanScore, tidakSopanScore) / totalScore
              : 0.5;

          return {
            prediction: sopanScore >= tidakSopanScore ? "sopan" : "tidak sopan",
            confidence: Math.min(0.95, Math.max(0.55, confidence)),
          };
        }

        addTrainingData(text, label) {
          this.trainingData.push({
            text,
            label,
            timestamp: new Date().toISOString(),
          });
          this.saveTrainingData();
          this.updateStats();
        }

        calculateAccuracy() {
          if (this.totalPredictions === 0) return 0;
          return Math.round(
            (this.correctPredictions / this.totalPredictions) * 100
          );
        }

        updateStats() {
          document.getElementById("totalData").textContent =
            this.trainingData.length;
          document.getElementById("accuracy").textContent =
            this.calculateAccuracy() + "%";
          document.getElementById("sopanCount").textContent =
            this.trainingData.filter((item) => item.label === "sopan").length;
          document.getElementById("tidakSopanCount").textContent =
            this.trainingData.filter(
              (item) => item.label === "tidak sopan"
            ).length;
        }

        initializeUI() {
          const analyzeBtn = document.getElementById("analyzeBtn");
          const chatInput = document.getElementById("chatInput");
          const correctBtn = document.getElementById("correctBtn");
          const wrongBtn = document.getElementById("wrongBtn");
          const correctSopan = document.getElementById("correctSopan");
          const correctTidakSopan =
            document.getElementById("correctTidakSopan");
          const showDataBtn = document.getElementById("showDataBtn");
          const clearDataBtn = document.getElementById("clearDataBtn");
          const exportDataBtn = document.getElementById("exportDataBtn");

          analyzeBtn.addEventListener("click", () => this.analyzePoliteness());
          chatInput.addEventListener("keypress", (e) => {
            if (e.key === "Enter" && e.ctrlKey) {
              this.analyzePoliteness();
            }
          });

          correctBtn.addEventListener("click", () => this.handleFeedback(true));
          wrongBtn.addEventListener("click", () => this.handleFeedback(false));
          correctSopan.addEventListener("click", () =>
            this.handleCorrection("sopan")
          );
          correctTidakSopan.addEventListener("click", () =>
            this.handleCorrection("tidak sopan")
          );

          showDataBtn.addEventListener("click", () => this.toggleDataDisplay());
          clearDataBtn.addEventListener("click", () => this.clearModel());
          exportDataBtn.addEventListener("click", () => this.exportData());
        }

        analyzePoliteness() {
          const text = document.getElementById("chatInput").value.trim();
          if (!text) {
            alert("Silakan masukkan teks terlebih dahulu!");
            return;
          }

          this.currentText = text;
          const result = this.predict(text);
          this.currentPrediction = result;
          this.totalPredictions++;

          this.displayResult(result);
        }

        displayResult(result) {
          const resultSection = document.getElementById("resultSection");
          const predictionResult = document.getElementById("predictionResult");
          const confidenceScore = document.getElementById("confidenceScore");

          predictionResult.textContent = result.prediction.toUpperCase();
          predictionResult.className = `prediction ${result.prediction.replace(
            " ",
            "-"
          )}`;

          confidenceScore.textContent = `Tingkat Keyakinan: ${Math.round(
            result.confidence * 100
          )}%`;

          resultSection.style.display = "block";
          document.getElementById("correctionSection").style.display = "none";

          // Scroll to result
          resultSection.scrollIntoView({ behavior: "smooth" });
        }

        handleFeedback(isCorrect) {
          if (isCorrect) {
            this.correctPredictions++;
            this.addTrainingData(
              this.currentText,
              this.currentPrediction.prediction
            );
            this.showFeedbackMessage(
              "‚úÖ Terima kasih! Prediksi benar dan telah disimpan."
            );
          } else {
            document.getElementById("correctionSection").style.display =
              "block";
          }
          this.updateStats();
        }

        handleCorrection(correctLabel) {
          this.addTrainingData(this.currentText, correctLabel);
          this.showFeedbackMessage(
            "üîß Terima kasih atas koreksinya! Model telah diperbarui."
          );
          document.getElementById("correctionSection").style.display = "none";
          this.updateStats();
        }

        showFeedbackMessage(message) {
          const existingMsg = document.querySelector(".feedback-message");
          if (existingMsg) existingMsg.remove();

          const msgDiv = document.createElement("div");
          msgDiv.className = "feedback-message";
          msgDiv.textContent = message;
          msgDiv.style.cssText = `
                    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
                    color: white;
                    padding: 15px;
                    margin: 15px 0;
                    border-radius: 10px;
                    text-align: center;
                    animation: slideIn 0.3s ease;
                `;

          document.getElementById("resultSection").appendChild(msgDiv);
          setTimeout(() => msgDiv.remove(), 3000);
        }

        toggleDataDisplay() {
          const dataList = document.getElementById("trainingDataList");
          const btn = document.getElementById("showDataBtn");

          if (dataList.style.display === "none") {
            this.displayTrainingData();
            dataList.style.display = "block";
            btn.textContent = "Sembunyikan Data";
          } else {
            dataList.style.display = "none";
            btn.textContent = "Tampilkan Data";
          }
        }

        displayTrainingData() {
          const dataList = document.getElementById("trainingDataList");
          dataList.innerHTML = "";

          if (this.trainingData.length === 0) {
            dataList.innerHTML = "<p>Belum ada data training</p>";
            return;
          }

          this.trainingData.forEach((item, index) => {
            const dataItem = document.createElement("div");
            dataItem.className = `data-item ${item.label.replace(" ", "-")}`;
            dataItem.innerHTML = `
                        <div class="data-text">"${item.text}"</div>
                        <div class="data-label">Label: ${item.label} ${
              item.timestamp
                ? `| ${new Date(item.timestamp).toLocaleString()}`
                : ""
            }</div>
                    `;
            dataList.appendChild(dataItem);
          });
        }

        clearModel() {
          if (
            confirm(
              "Apakah Anda yakin ingin menghapus semua data training? Tindakan ini tidak dapat dibatalkan."
            )
          ) {
            sessionStorage.removeItem("politenessTrainingData");
            this.trainingData = this.loadTrainingData();
            this.correctPredictions = 0;
            this.totalPredictions = 0;
            this.updateStats();
            document.getElementById("trainingDataList").style.display = "none";
            document.getElementById("showDataBtn").textContent =
              "Tampilkan Data";
            alert("Model berhasil direset!");
          }
        }

        exportData() {
          const dataStr = JSON.stringify(this.trainingData, null, 2);
          const dataBlob = new Blob([dataStr], { type: "application/json" });
          const url = URL.createObjectURL(dataBlob);
          const link = document.createElement("a");
          link.href = url;
          link.download = `politeness_training_data_${
            new Date().toISOString().split("T")[0]
          }.json`;
          link.click();
          URL.revokeObjectURL(url);
        }
      }

      // Initialize the application
      document.addEventListener("DOMContentLoaded", () => {
        new PolitenessDetector();
      });

      // Add animation keyframes
      const style = document.createElement("style");
      style.textContent = `
            @keyframes slideIn {
                from { transform: translateY(-20px); opacity: 0; }
                to { transform: translateY(0); opacity: 1; }
            }
        `;
      document.head.appendChild(style);
    </script>
  </body>
</html>
